<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>REACTOR ‚Äî –£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="demo-banner">
    –î–ï–ú–û-–í–ï–†–°–ò–Ø
  </div>

  <div id="top-ui">
    <button id="profile-btn" class="icon-btn" title="Profile">üë§</button>
    <button id="settings-btn" class="icon-btn" title="Settings">‚öôÔ∏è</button>
    <button id="changelog-btn" class="icon-btn" title="Changelog">üìñ</button>
    <button id="support-btn" class="icon-btn" title="Support">üí¨</button>
    <button id="info-btn" class="icon-btn" title="Info">‚ùì</button>
  </div>

  <div id="main-menu" class="screen active">
    <h1>REACTOR</h1>
    <p class="subtitle">
      –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫—É—é –∏–≥—Ä—É, –≥–¥–µ –∫–∞–∂–¥—ã–π —Ö–æ–¥ —Ä–µ—à–∞–µ—Ç –∏—Å—Ö–æ–¥ –±–∏—Ç–≤—ã –∑–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å!<br>
      –ü–æ—Å—Ç—Ä–æ–π—Ç–µ —Ä–µ–∞–∫—Ç–æ—Ä—ã, –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–π—Ç–µ –∫–ª–µ—Ç–∫–∏ –∏ –æ–±—ã–≥—Ä–∞–π—Ç–µ –±–æ—Ç–∞ –∑–∞ 14 —Ö–æ–¥–æ–≤.
    </p>
    <div class="auth-container">
      <button id="google-btn" class="google-btn auth-btn">
        <svg width="20" height="20" viewBox="0 0 24 24"><path fill="#fff" d="M12.24 10.285V14.4h6.806c-.275 1.765-2.056 5.174-6.806 5.174-4.095 0-7.439-3.389-7.439-7.574s3.345-7.574 7.439-7.574c2.33 0 3.891.989 4.785 1.849l3.234-3.138C18.189 1.186 15.479 0 12.24 0c-6.635 0-12 5.365-12 12s5.365 12 12 12c6.926 0 11.52-4.869 11.52-11.726 0-.788-.085-1.39-.189-1.989H12.24z"/></svg>
        <span>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å Google</span>
        <div class="spinner"></div>
      </button>
      <button onclick="loginAsGuest()" class="guest-btn auth-btn">
        –ò–≥—Ä–∞—Ç—å –∫–∞–∫ –≥–æ—Å—Ç—å
      </button>
    </div>
    <div id="user-info" style="display:none;margin-top:30px">
      <div id="user-avatar"></div>
      <div id="user-name" style="margin-top:12px;font-weight:bold;font-size:20px"></div>
      <button onclick="goToStartScreen()" style="margin-top:16px;padding:12px 28px">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
      <button id="logout-btn" onclick="logout()" style="margin-top:10px;padding:10px 24px">–í—ã–π—Ç–∏</button>
    </div>
  </div>

  <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ —ç–∫—Ä–∞–Ω—ã –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->
  <div id="start-screen" class="screen">
    <h1>REACTOR</h1>
    <p>–ö—Ç–æ –Ω–∞—á–Ω—ë—Ç –ø–µ—Ä–≤—ã–º?</p>
    <div class="dice" id="dice">?</div>
    <button onclick="startToss()">–ü–æ–¥–±—Ä–æ—Å–∏—Ç—å –∫—É–±–∏–∫</button>
    <button onclick="goToRatingScreen()" style="margin-top: 12px; background: linear-gradient(45deg, #4deeea, #ff6b6b);">–†–µ–π—Ç–∏–Ω–≥–æ–≤—ã–π —Ä–µ–∂–∏–º</button>
  </div>

  <!-- –†–µ–π—Ç–∏–Ω–≥–æ–≤—ã–π —ç–∫—Ä–∞–Ω -->
  <div id="rating-screen" class="screen">
    <h1>–†–ï–ô–¢–ò–ù–ì–û–í–´–ô –†–ï–ñ–ò–ú</h1>
    <p>–í—ã–±–µ—Ä–∏—Ç–µ –¥–∏–≤–∏–∑–∏–æ–Ω –¥–ª—è –∏–≥—Ä—ã —Å –±–æ—Ç–∞–º–∏</p>
    
    <div class="rating-divisions">
      <div class="division-card" onclick="startRatingGame('silver')">
        <div class="division-header silver">
          <h2>–°–ï–†–ï–ë–†–û</h2>
          <div class="division-icon">ü•à</div>
        </div>
        <div class="division-stats">
          <div class="rating-display">–†–µ–π—Ç–∏–Ω–≥: <span id="silver-rating">1000</span></div>
          <div class="winrate-display">–í–∏–Ω—Ä–µ–π—Ç: <span id="silver-winrate">0%</span></div>
        </div>
        <div class="division-info">
          <div>–£—Ä–æ–≤–µ–Ω—å –±–æ—Ç–∞: –°—Ä–µ–¥–Ω–∏–π</div>
          <div>–ù–∞–≥—Ä–∞–¥–∞: +10 –∑–∞ –ø–æ–±–µ–¥—É</div>
        </div>
      </div>
      
      <div class="division-card" onclick="startRatingGame('gold')">
        <div class="division-header gold">
          <h2>–ó–û–õ–û–¢–û</h2>
          <div class="division-icon">ü•á</div>
        </div>
        <div class="division-stats">
          <div class="rating-display">–†–µ–π—Ç–∏–Ω–≥: <span id="gold-rating">1300</span></div>
          <div class="winrate-display">–í–∏–Ω—Ä–µ–π—Ç: <span id="gold-winrate">0%</span></div>
        </div>
        <div class="division-info">
          <div>–£—Ä–æ–≤–µ–Ω—å –±–æ—Ç–∞: –í—ã—Å–æ–∫–∏–π</div>
          <div>–ù–∞–≥—Ä–∞–¥–∞: +15 –∑–∞ –ø–æ–±–µ–¥—É</div>
        </div>
      </div>
      
      <div class="division-card" onclick="startRatingGame('platinum')">
        <div class="division-header platinum">
          <h2>–ü–õ–ê–¢–ò–ù–ê</h2>
          <div class="division-icon">üíé</div>
        </div>
        <div class="division-stats">
          <div class="rating-display">–†–µ–π—Ç–∏–Ω–≥: <span id="platinum-rating">1600</span></div>
          <div class="winrate-display">–í–∏–Ω—Ä–µ–π—Ç: <span id="platinum-winrate">0%</span></div>
        </div>
        <div class="division-info">
          <div>–£—Ä–æ–≤–µ–Ω—å –±–æ—Ç–∞: –≠–∫—Å–ø–µ—Ä—Ç</div>
          <div>–ù–∞–≥—Ä–∞–¥–∞: +20 –∑–∞ –ø–æ–±–µ–¥—É</div>
        </div>
      </div>
    </div>
    
    <div class="season-info">
      <div class="season-timer">–°–µ–∑–æ–Ω –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑: <span id="season-timer">7 –¥–Ω–µ–π</span></div>
      <div class="current-season">–°–µ–∑–æ–Ω 1</div>
    </div>
    
    <button onclick="goToStartScreen()" style="margin-top: 20px; background: linear-gradient(45deg, #555, #777);">–ù–∞–∑–∞–¥</button>
  </div>

  <div id="game-screen" class="screen">
    <h1>REACTOR</h1>
    <div id="score">
      <div class="score-box you">–¢—ã: <span id="you-score">0</span></div>
      <div class="score-box bot">–ë–æ—Ç: <span id="bot-score">0</span></div>
    </div>
    <div id="status">–û–∂–∏–¥–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞...</div>
    <div id="board"></div>
    <div id="controls">
      <button onclick="resetToStart()">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
    </div>
    <div id="footer">
      –ö–∞–∂–¥—ã–π —Ä–µ–∞–∫—Ç–æ—Ä (‚óè) –ø–µ—Ä–µ–∫—Ä–∞—à–∏–≤–∞–µ—Ç —Å–æ—Å–µ–¥–Ω–∏–µ –∫–ª–µ—Ç–∫–∏.<br>
      –ü–æ—Å–ª–µ 14 —Ö–æ–¥–æ–≤ –ø–æ–±–µ–∂–¥–∞–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—â–∏–π –±–æ–ª—å—à–µ.
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ (profile, changelog, info –∏ —Ç.–¥.) ‚Äî –∫–∞–∫ –≤ v0.3.1 -->
  <div id="profile-modal" class="modal-overlay">
    <div class="modal">
      <button class="close-modal" onclick="closeModal('profile-modal')">
        <svg viewBox="0 0 24 24">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
      </button>
      <h2>Profile</h2>
      <div id="profile-stats"></div>
      <button id="profile-logout-btn" onclick="logout()" style="margin-top:16px;background:#555">–í—ã–π—Ç–∏</button>
    </div>
  </div>

  <div id="settings-modal" class="modal-overlay">
    <div class="modal">
      <button class="close-modal" onclick="closeModal('settings-modal')">
        <svg viewBox="0 0 24 24">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
      </button>
      <h2>Settings</h2>
      <p>Soon</p>
    </div>
  </div>

  <div id="changelog-modal" class="modal-overlay">
    <div class="modal">
      <button class="close-modal" onclick="closeModal('changelog-modal')">
        <svg viewBox="0 0 24 24">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
      </button>
      <h2>Changelog</h2>

      <div class="patch-entry">
        <div class="patch-header" onclick="togglePatch('patch-032')">
          v0.3.2
          <svg class="patch-arrow" id="arrow-032" viewBox="0 0 24 24">
            <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
          </svg>
        </div>
        <div class="patch-content" id="patch-032">
          <ul>
            <li>‚Ä¢ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∞–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–æ–∫</li>
            <li>‚Ä¢ –ò–∫–æ–Ω–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏ –≤—Ö–æ–¥–µ —á–µ—Ä–µ–∑ Google</li>
            <li>‚Ä¢ –û–±–Ω–æ–≤–ª—ë–Ω –¥–∏–∑–∞–π–Ω –∫–Ω–æ–ø–æ–∫ (Google + –≥–æ—Å—Ç—å)</li>
          </ul>
        </div>
      </div>

      <div class="patch-entry">
        <div class="patch-header" onclick="togglePatch('patch-031')">
          v0.3.1
          <svg class="patch-arrow" id="arrow-031" viewBox="0 0 24 24">
            <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
          </svg>
        </div>
        <div class="patch-content" id="patch-031">
          <ul>
            <li>‚Ä¢ –î–æ–±–∞–≤–ª–µ–Ω –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ Google</li>
            <li>‚Ä¢ VK –≤—Ä–µ–º–µ–Ω–Ω–æ —É–±—Ä–∞–Ω</li>
          </ul>
        </div>
      </div>

      <div class="patch-entry">
        <div class="patch-header" onclick="togglePatch('patch-030')">
          v0.3.0
          <svg class="patch-arrow" id="arrow-030" viewBox="0 0 24 24">
            <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
          </svg>
        </div>
        <div class="patch-content" id="patch-030">
          <ul>
            <li>‚Ä¢ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</li>
            <li>‚Ä¢ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã Changelog –∏ Info</li>
            <li>‚Ä¢ –í—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ‚Äî —á–µ—Ä–µ–∑ –∫–∞—Å—Ç–æ–º–Ω—ã–µ –º–æ–¥–∞–ª–∫–∏</li>
          </ul>
        </div>
      </div>

      <div class="patch-entry">
        <div class="patch-header" onclick="togglePatch('patch-021')">
          v0.2.1
          <svg class="patch-arrow" id="arrow-021" viewBox="0 0 24 24">
            <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
          </svg>
        </div>
        <div class="patch-content" id="patch-021">
          <ul>
            <li>‚Ä¢ –ü–æ–ª–µ 7√ó7, 14 —Ö–æ–¥–æ–≤</li>
            <li>‚Ä¢ –¶–µ–ø–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è, –∑–≤—É–∫–∏</li>
          </ul>
        </div>
      </div>

      <div class="patch-entry">
        <div class="patch-header" onclick="togglePatch('patch-02')">
          v0.2
          <svg class="patch-arrow" id="arrow-02" viewBox="0 0 24 24">
            <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
          </svg>
        </div>
        <div class="patch-content" id="patch-02">
          <ul>
            <li>‚Ä¢ –£–ª—É—á—à–µ–Ω–Ω—ã–π –ò–ò-–±–æ—Ç</li>
            <li>‚Ä¢ –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞, –ø—Ä–æ—Ñ–∏–ª—å, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</li>
          </ul>
        </div>
      </div>

      <div class="patch-entry">
        <div class="patch-header" onclick="togglePatch('patch-01')">
          v0.1
          <svg class="patch-arrow" id="arrow-01" viewBox="0 0 24 24">
            <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
          </svg>
        </div>
        <div class="patch-content" id="patch-01">
          <ul>
            <li>‚Ä¢ –ë–∞–∑–æ–≤–∞—è –∏–≥—Ä–∞: 5√ó5, 10 —Ö–æ–¥–æ–≤</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <div id="support-modal" class="modal-overlay">
    <div class="modal">
      <button class="close-modal" onclick="closeModal('support-modal')">
        <svg viewBox="0 0 24 24">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
      </button>
      <h2>–û–Ω–ª–∞–π–Ω-–ø–æ–¥–¥–µ—Ä–∂–∫–∞</h2>
      <p>Soon</p>
    </div>
  </div>

  <div id="info-modal" class="modal-overlay">
    <div class="modal">
      <button class="close-modal" onclick="closeModal('info-modal')">
        <svg viewBox="0 0 24 24">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
      </button>
      <h2>Info</h2>

      <div class="info-section">
        <div class="info-header" onclick="toggleInfo('rules')">
          –ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã
          <svg class="info-arrow" id="arrow-rules" viewBox="0 0 24 24">
            <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
          </svg>
        </div>
        <div class="info-content" id="rules">
          <p>‚Ä¢ –ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ: <strong>7√ó7 –∫–ª–µ—Ç–æ–∫</strong>.</p>
          <p>‚Ä¢ –í—Å–µ–≥–æ <strong>14 —Ö–æ–¥–æ–≤</strong> (–ø–æ 7 –Ω–∞ –∏–≥—Ä–æ–∫–∞).</p>
          <p>‚Ä¢ –ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ —Ä–µ–∞–∫—Ç–æ—Ä–∞ (‚óè) –≤—ã –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç–µ:</p>
          <p style="padding-left: 20px;">‚Äî –∫–ª–µ—Ç–∫—É —Å —Ä–µ–∞–∫—Ç–æ—Ä–æ–º,</p>
          <p style="padding-left: 20px;">‚Äî –≤—Å–µ 4 —Å–æ—Å–µ–¥–Ω–∏–µ –∫–ª–µ—Ç–∫–∏.</p>
          <p>‚Ä¢ –ü–æ–±–µ–∂–¥–∞–µ—Ç –∏–≥—Ä–æ–∫, –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—â–∏–π –±–æ–ª—å—à–µ –∫–ª–µ—Ç–æ–∫ –ø–æ—Å–ª–µ 14 —Ö–æ–¥–æ–≤.</p>
        </div>
      </div>

      <div class="info-section">
        <div class="info-header" onclick="toggleInfo('agreement')">
          –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ
          <svg class="info-arrow" id="arrow-agreement" viewBox="0 0 24 24">
            <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
          </svg>
        </div>
        <div class="info-content" id="agreement">
          <p>‚Ä¢ –î–∞–Ω–Ω–∞—è –¥–µ–º–æ-–≤–µ—Ä—Å–∏—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è ¬´–∫–∞–∫ –µ—Å—Ç—å¬ª.</p>
          <p>‚Ä¢ –ê–≤—Ç–æ—Ä –Ω–µ –Ω–µ—Å—ë—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ —É—â–µ—Ä–±.</p>
          <p>‚Ä¢ –ò–≥—Ä–∞ –Ω–µ —Å–æ–±–∏—Ä–∞–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.</p>
          <p>‚Ä¢ –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã. –ó–∞–ø—Ä–µ—â–µ–Ω–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ.</p>
        </div>
      </div>

      <div class="info-section">
        <div class="info-header" onclick="toggleInfo('about')">
          –û –ø—Ä–æ–µ–∫—Ç–µ
          <svg class="info-arrow" id="arrow-about" viewBox="0 0 24 24">
            <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
          </svg>
        </div>
        <div class="info-content" id="about">
          <p>–ò–≥—Ä–∞ <strong>REACTOR</strong> —Å–æ–∑–¥–∞–Ω–∞ –∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç <strong>G3laZi Project</strong>.</p>
          <p>–í–µ—Ä—Å–∏—è: v0.3.2 (–¥–µ–º–æ)</p>
          <p>¬© 2025 G3laZi Project. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- üì¢ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
  <div id="notification-modal" class="modal-overlay">
    <div class="modal notification-modal">
      <button class="close-modal" onclick="closeNotification()">
        <svg viewBox="0 0 24 24">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
      </button>
      <h2 id="notification-title">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</h2>
      <p id="notification-text">–°–æ–æ–±—â–µ–Ω–∏–µ</p>
    </div>
  </div>

  <script>
    const SIZE = 7;
    const TOTAL_MOVES = 14;
    let board, reactors, moveCount, gameActive, currentPlayer, currentUser = null;

    // –°–æ–∑–¥–∞–Ω–∏–µ –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —á–∞—Å—Ç–∏—Ü —Ñ–æ–Ω–∞
    function createBackgroundParticles() {
      const container = document.getElementById('background-animation');
      container.innerHTML = '';
      
      for (let i = 0; i < 20; i++) {
        const particle = document.createElement('div');
        particle.classList.add('particle');
        
        // –°–ª—É—á–∞–π–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —á–∞—Å—Ç–∏—Ü—ã
        const size = Math.random() * 20 + 5;
        const posX = Math.random() * 100;
        const posY = Math.random() * 100 + 100; // –ù–∞—á–∏–Ω–∞–µ–º –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ —ç–∫—Ä–∞–Ω–∞
        const duration = Math.random() * 20 + 10;
        const delay = Math.random() * 5;
        const hue = Math.random() > 0.5 ? 180 : 0; // –ì–æ–ª—É–±–æ–π –∏–ª–∏ –∫—Ä–∞—Å–Ω—ã–π
        
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        particle.style.left = `${posX}%`;
        particle.style.top = `${posY}%`;
        particle.style.background = `hsla(${hue}, 70%, 60%, 0.5)`;
        particle.style.animation = `float ${duration}s linear ${delay}s infinite`;
        
        container.appendChild(particle);
      }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–∞—Å—Ç–∏—Ü –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    window.addEventListener('load', createBackgroundParticles);

    // üîä –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–≤—É–∫–∞
    let audioInitialized = false;
    function initAudio() {
      if (audioInitialized) return;
      audioInitialized = true;
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const oscillator = ctx.createOscillator();
      const gain = ctx.createGain();
      oscillator.connect(gain);
      gain.connect(ctx.destination);
      gain.gain.setValueAtTime(0.001, ctx.currentTime);
      oscillator.start();
      oscillator.stop(ctx.currentTime + 0.1);
    }
    document.body.addEventListener('click', initAudio, { once: true });
    document.body.addEventListener('touchstart', initAudio, { once: true });

    // üîä –ó–≤—É–∫–∏
    function playSound(id) {
      if (!audioInitialized) return;
      const sound = document.getElementById(`sound-${id}`);
      if (sound) {
        sound.currentTime = 0;
        sound.play().catch(e => console.log("Audio play prevented:", e));
      }
    }

    // üì¢ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    function showNotification(title, text) {
      document.getElementById('notification-title').textContent = title;
      document.getElementById('notification-text').textContent = text;
      document.getElementById('notification-modal').classList.add('active');
    }
    function closeNotification() {
      document.getElementById('notification-modal').classList.remove('active');
    }

    // üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    function saveUser(user) {
      localStorage.setItem('reactor_user', JSON.stringify(user));
      currentUser = user;
      updateUI();
    }
    function loadUser() {
      const saved = localStorage.getItem('reactor_user');
      currentUser = saved ? JSON.parse(saved) : null;
      updateUI();
    }
    function updateUI() {
      const authContainer = document.querySelector('.auth-container');
      const userInfo = document.getElementById('user-info');
      const userName = document.getElementById('user-name');
      const avatar = document.getElementById('user-avatar');

      if (currentUser) {
        authContainer.style.display = 'none';
        userInfo.style.display = 'block';
        userName.textContent = currentUser.name || '–ò–≥—Ä–æ–∫';
        avatar.textContent = (currentUser.name || '?')[0].toUpperCase();
        avatar.style.background = currentUser.photo 
          ? `url(${currentUser.photo}) center/cover no-repeat` 
          : '#4deeea';
      } else {
        authContainer.style.display = 'flex';
        userInfo.style.display = 'none';
      }
      renderStats();
    }

    // üö™ –í—ã—Ö–æ–¥
    function logout() {
      localStorage.removeItem('reactor_user');
      currentUser = null;
      updateUI();
      document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('active'));
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById('main-menu').classList.add('active');
    }

    // üü¢ Google (—Å —Ç–≤–æ–∏–º ID + –∏–∫–æ–Ω–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏)
    function loginWithGoogle() {
      const btn = document.getElementById('google-btn');
      btn.classList.add('loading');
      
      const client = google.accounts.oauth2.initTokenClient({
        client_id: '712124061862-fun5umqbl2u9d4fsnve4pi4h2g4b21ug.apps.googleusercontent.com',
        scope: 'https://www.googleapis.com/auth/userinfo.profile',
        callback: (tokenResponse) => {
          btn.classList.remove('loading');
          if (tokenResponse.access_token) {
            fetch('https://www.googleapis.com/oauth2/v3/userinfo', {
              headers: { Authorization: `Bearer ${tokenResponse.access_token}` }
            })
            .then(res => res.json())
            .then(user => {
              saveUser({
                id: 'google_' + user.sub,
                name: user.name || user.given_name || 'Google User',
                photo: user.picture || null
              });
            })
            .catch(err => {
              console.error("Google login error:", err);
              showNotification("–û—à–∏–±–∫–∞", "–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google");
            });
          } else {
            showNotification("–û—à–∏–±–∫–∞", "–û—Ç–º–µ–Ω–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º");
          }
        }
      });
      client.requestAccessToken();
    }

    // üé© –ì–æ—Å—Ç—å
    function loginAsGuest() {
      const guestName = prompt("–ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç?", "–ò–≥—Ä–æ–∫");
      if (guestName) {
        saveUser({
          id: 'guest_' + Date.now(),
          name: guestName.trim() || '–ò–≥—Ä–æ–∫',
          isGuest: true
        });
      }
    }

    // üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    function getStatsKey() {
      return currentUser ? `reactor_stats_${currentUser.id}` : 'reactor_stats_guest';
    }
    function loadStats() {
      const key = getStatsKey();
      const saved = localStorage.getItem(key);
      return saved ? JSON.parse(saved) : { wins: 0, losses: 0, draws: 0 };
    }
    function saveStats(stats) {
      const key = getStatsKey();
      localStorage.setItem(key, JSON.stringify(stats));
    }
    function updateStats(result) {
      const stats = loadStats();
      if (result === 'win') stats.wins++;
      else if (result === 'loss') stats.losses++;
      else stats.draws++;
      saveStats(stats);
      renderStats();
    }
    function renderStats() {
      const stats = loadStats();
      const el = document.getElementById('profile-stats');
      if (el) {
        const total = stats.wins + stats.losses + stats.draws;
        const winrate = total ? Math.round((stats.wins / total) * 100) : 0;
        const name = currentUser ? currentUser.name : '–ì–æ—Å—Ç—å';
        el.innerHTML = `
          <div class="stats-box">
            <div class="stats-row">
              <span class="stats-label">üë§ –ò–≥—Ä–æ–∫:</span>
              <span class="stats-value">${name}</span>
            </div>
            <div class="stats-row">
              <span class="stats-label">üèÜ –ü–æ–±–µ–¥:</span>
              <span class="stats-value">${stats.wins}</span>
            </div>
            <div class="stats-row">
              <span class="stats-label">üíî –ü–æ—Ä–∞–∂–µ–Ω–∏–π:</span>
              <span class="stats-value">${stats.losses}</span>
            </div>
            <div class="stats-row">
              <span class="stats-label">üìà –í–∏–Ω—Ä–µ–π—Ç:</span>
              <span class="stats-value ${winrate >= 50 ? 'winrate-good' : 'winrate-bad'}">${winrate}%</span>
            </div>
          </div>
        `;
      }
    }

    // ‚öôÔ∏è –ò–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
    function goToStartScreen() {
      if (!currentUser) {
        showNotification("–û—à–∏–±–∫–∞", "–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Å—Ç—è");
        return;
      }
      document.getElementById('main-menu').classList.remove('active');
      document.getElementById('start-screen').classList.add('active');
    }

    function startToss() {
      playSound('toss');
      const dice = document.getElementById('dice');
      dice.textContent = '?';
      dice.className = 'dice animate';

      setTimeout(() => {
        const firstPlayer = Math.random() > 0.5 ? 'human' : 'bot';
        dice.textContent = firstPlayer === 'human' ? 'üë§' : 'ü§ñ';
        dice.style.color = firstPlayer === 'human' ? '#4deeea' : '#ff6b6b';
        dice.classList.remove('animate');

        setTimeout(() => {
          document.getElementById('start-screen').classList.remove('active');
          document.getElementById('game-screen').classList.add('active');
          initGame(firstPlayer);
        }, 600);
      }, 2200);
    }

    function initGame(firstPlayer) {
      board = Array(SIZE).fill().map(() => Array(SIZE).fill(0));
      reactors = Array(SIZE).fill().map(() => Array(SIZE).fill(false));
      moveCount = 0;
      gameActive = true;
      currentPlayer = firstPlayer;

      const statusEl = document.getElementById('status');
      if (currentPlayer === 'human') {
        statusEl.textContent = '–¢–≤–æ–π —Ö–æ–¥ ‚Äî –ø–æ—Å—Ç–∞–≤—å —Ä–µ–∞–∫—Ç–æ—Ä';
      } else {
        statusEl.textContent = '–ë–æ—Ç —Ö–æ–¥–∏—Ç –ø–µ—Ä–≤—ã–º...';
        render();
        // –í—ã–∑—ã–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é botMove –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞
        if (ratingData.currentDivision) {
          setTimeout(ratingBotMove, 800);
        } else {
          setTimeout(botMove, 800);
        }
      }
      render();
    }

    function render() {
      const boardEl = document.getElementById('board');
      boardEl.innerHTML = '';
      let youScore = 0, botScore = 0;

      for (let r = 0; r < SIZE; r++) {
        for (let c = 0; c < SIZE; c++) {
          const cell = document.createElement('div');
          cell.className = 'cell';
          if (board[r][c] === 1) {
            cell.classList.add('player1');
            youScore++;
          } else if (board[r][c] === 2) {
            cell.classList.add('player2');
            botScore++;
          }
          if (reactors[r][c]) cell.classList.add('reactor');

          if (gameActive && board[r][c] === 0 && moveCount < TOTAL_MOVES && currentPlayer === 'human') {
            cell.onclick = () => playerMove(r, c);
          }
          boardEl.appendChild(cell);
        }
      }

      document.getElementById('you-score').textContent = youScore;
      document.getElementById('bot-score').textContent = botScore;

      if (moveCount >= TOTAL_MOVES && gameActive) {
        gameActive = false;
        const statusEl = document.getElementById('status');
        let resultType = 'draw';
        if (youScore > botScore) {
          statusEl.textContent = 'üèÜ –ü–æ–±–µ–¥–∞!';
          resultType = 'win';
        } else if (botScore > youScore) {
          statusEl.textContent = 'üíî –ü–æ—Ä–∞–∂–µ–Ω–∏–µ.';
          resultType = 'loss';
        } else {
          statusEl.textContent = 'ü§ù –ù–∏—á—å—è!';
        }
        playSound('result');
        updateStats(resultType);
      }
    }

    // ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è activateReactor
    function activateReactor(row, col, player) {
      reactors[row][col] = true;
      board[row][col] = player;
      const dirs = [[-1,0], [1,0], [0,-1], [0,1]];
      
      let chainReaction = false;
      for (const [dr, dc] of dirs) {
        const nr = row + dr, nc = col + dc;
        if (nr >= 0 && nr < SIZE && nc >= 0 && nc < SIZE) {
          if (reactors[nr][nc]) chainReaction = true;
        }
      }

      for (const [dr, dc] of dirs) {
        const nr = row + dr, nc = col + dc;
        if (nr >= 0 && nr < SIZE && nc >= 0 && nc < SIZE) {
          board[nr][nc] = player;
          const cellIndex = nr * SIZE + nc;
          const cell = document.querySelector(`#board > .cell:nth-child(${cellIndex + 1})`);
          if (cell && chainReaction) {
            cell.classList.remove('chain');
            void cell.offsetWidth;
            cell.classList.add('chain');
          }
        }
      }

      playSound('click');
    }

    function playerMove(r, c) {
      if (!gameActive || currentPlayer !== 'human' || board[r][c] !== 0) return;
      activateReactor(r, c, 1);
      moveCount++;
      currentPlayer = 'bot';
      if (moveCount < TOTAL_MOVES) {
        document.getElementById('status').textContent = '–•–æ–¥ –±–æ—Ç–∞...';
        render();
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫–∞–∫—É—é –≤–µ—Ä—Å–∏—é botMove –≤—ã–∑—ã–≤–∞—Ç—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞
        if (ratingData.currentDivision) {
          setTimeout(ratingBotMove, 600);
        } else {
          setTimeout(botMove, 600);
        }
      } else {
        render();
      }
    }

    function botMove() {
      if (!gameActive || currentPlayer !== 'bot') return;

      const phase = moveCount < 5 ? 'early' : moveCount < 10 ? 'mid' : 'late';
      let moves = [];
      const dirs = [[-1,0],[1,0],[0,-1],[0,1]];

      for (let r = 0; r < SIZE; r++) {
        for (let c = 0; c < SIZE; c++) {
          if (board[r][c] !== 0) continue;

          let baseValue = 0;
          for (const [dr, dc] of dirs) {
            const nr = r + dr, nc = c + dc;
            if (nr >= 0 && nr < SIZE && nc >= 0 && nc < SIZE) {
              if (board[nr][nc] === 1) baseValue += 10;
              else if (board[nr][nc] === 0) baseValue += 4;
              else if (board[nr][nc] === 2) baseValue += 1;
            }
          }
          if (phase === 'early' && r >= 2 && r <= 4 && c >= 2 && c <= 4) {
            baseValue += 4;
          }

          let threatValue = 0;
          for (const [dr, dc] of dirs) {
            const nr = r + dr, nc = c + dc;
            if (nr >= 0 && nr < SIZE && nc >= 0 && nc < SIZE && board[nr][nc] === 1) {
              let futureDamage = 0;
              for (const [dr2, dc2] of dirs) {
                const nnr = nr + dr2, nnc = nc + dc2;
                if (nnr >= 0 && nnr < SIZE && nnc >= 0 && nnc < SIZE) {
                  if (board[nnr][nnc] === 2) futureDamage++;
                }
              }
              threatValue = Math.max(threatValue, futureDamage * 5);
            }
          }

          let opponentResponseValue = 0;
          const simBoard = board.map(row => [...row]);
          simBoard[r][c] = 2;
          for (const [dr, dc] of dirs) {
            const nr = r + dr, nc = c + dc;
            if (nr >= 0 && nr < SIZE && nc >= 0 && nc < SIZE) {
              simBoard[nr][nc] = 2;
            }
          }
          let bestOpponentValue = 0;
          for (let or = 0; or < SIZE; or++) {
            for (let oc = 0; oc < SIZE; oc++) {
              if (simBoard[or][oc] === 0) {
                let val = 0;
                for (const [dr, dc] of dirs) {
                  const nnr = or + dr, nnc = oc + dc;
                  if (nnr >= 0 && nnr < SIZE && nnc >= 0 && nnc < SIZE) {
                    if (simBoard[nnr][nnc] === 2) val += 10;
                    else if (simBoard[nnr][nnc] === 0) val += 4;
                  }
                }
                bestOpponentValue = Math.max(bestOpponentValue, val);
              }
            }
          }
          opponentResponseValue = -bestOpponentValue * 0.7;

          let totalValue = baseValue + threatValue + opponentResponseValue;
          totalValue += (Math.random() - 0.5) * 2;

          moves.push({ r, c, value: totalValue });
        }
      }

      if (moves.length === 0) return;

      moves.sort((a, b) => b.value - a.value);
      const topMoves = moves.slice(0, 2);
      const chosen = topMoves[Math.floor(Math.random() * topMoves.length)];

      activateReactor(chosen.r, chosen.c, 2);
      moveCount++;
      currentPlayer = 'human';
      if (moveCount < TOTAL_MOVES) {
        document.getElementById('status').textContent = '–¢–≤–æ–π —Ö–æ–¥ ‚Äî –ø–æ—Å—Ç–∞–≤—å —Ä–µ–∞–∫—Ç–æ—Ä';
      }
      render();
    }

    function ratingBotMove() {
      if (!gameActive || currentPlayer !== 'bot') return;

      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥–∏–≤–∏–∑–∏–æ–Ω–∞
      let difficultyFactor = 1.0; // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
      switch(ratingData.currentDivision) {
        case 'silver':
          difficultyFactor = 0.8; // –±–æ–ª–µ–µ —Å–ª–∞–±—ã–π –±–æ—Ç
          break;
        case 'gold':
          difficultyFactor = 1.0; // –æ–±—ã—á–Ω—ã–π –±–æ—Ç
          break;
        case 'platinum':
          difficultyFactor = 1.3; // –±–æ–ª–µ–µ —Å–∏–ª—å–Ω—ã–π –±–æ—Ç
          break;
      }

      const phase = moveCount < 5 ? 'early' : moveCount < 10 ? 'mid' : 'late';
      let moves = [];
      const dirs = [[-1,0],[1,0],[0,-1],[0,1]];

      for (let r = 0; r < SIZE; r++) {
        for (let c = 0; c < SIZE; c++) {
          if (board[r][c] !== 0) continue;

          let baseValue = 0;
          for (const [dr, dc] of dirs) {
            const nr = r + dr, nc = c + dc;
            if (nr >= 0 && nr < SIZE && nc >= 0 && nc < SIZE) {
              if (board[nr][nc] === 1) baseValue += 10;
              else if (board[nr][nc] === 0) baseValue += 4;
              else if (board[nr][nc] === 2) baseValue += 1;
            }
          }
          if (phase === 'early' && r >= 2 && r <= 4 && c >= 2 && c <= 4) {
            baseValue += 4;
          }

          let threatValue = 0;
          for (const [dr, dc] of dirs) {
            const nr = r + dr, nc = c + dc;
            if (nr >= 0 && nr < SIZE && nc >= 0 && nc < SIZE && board[nr][nc] === 1) {
              let futureDamage = 0;
              for (const [dr2, dc2] of dirs) {
                const nnr = nr + dr2, nnc = nc + dc2;
                if (nnr >= 0 && nnr < SIZE && nnc >= 0 && nnc < SIZE) {
                  if (board[nnr][nnc] === 2) futureDamage++;
                }
              }
              threatValue = Math.max(threatValue, futureDamage * 5);
            }
          }

          let opponentResponseValue = 0;
          const simBoard = board.map(row => [...row]);
          simBoard[r][c] = 2;
          for (const [dr, dc] of dirs) {
            const nr = r + dr, nc = c + dc;
            if (nr >= 0 && nr < SIZE && nc >= 0 && nc < SIZE) {
              simBoard[nr][nc] = 2;
            }
          }
          let bestOpponentValue = 0;
          for (let or = 0; or < SIZE; or++) {
            for (let oc = 0; oc < SIZE; oc++) {
              if (simBoard[or][oc] === 0) {
                let val = 0;
                for (const [dr, dc] of dirs) {
                  const nnr = or + dr, nnc = oc + dc;
                  if (nnr >= 0 && nnr < SIZE && nnc >= 0 && nnc < SIZE) {
                    if (simBoard[nnr][nnc] === 2) val += 10;
                    else if (simBoard[nnr][nnc] === 0) val += 4;
                  }
                }
                bestOpponentValue = Math.max(bestOpponentValue, val);
              }
            }
          }
          opponentResponseValue = -bestOpponentValue * 0.7;

          let totalValue = baseValue + threatValue + opponentResponseValue;
          
          // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∞–∫—Ç–æ—Ä —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
          totalValue = totalValue * difficultyFactor;
          totalValue += (Math.random() - 0.5) * (2 / difficultyFactor); // –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º —Ä–∞–Ω–¥–æ–º –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏

          moves.push({ r, c, value: totalValue });
        }
      }

      if (moves.length === 0) return;

      moves.sort((a, b) => b.value - a.value);
      
      // –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –≤—ã–±–∏—Ä–∞–µ–º –ª—É—á—à–∏–π —Ö–æ–¥ –∏–ª–∏ —á—É—Ç—å —Ö—É–¥—à–∏–π
      let chosen;
      if (ratingData.currentDivision === 'platinum') {
        // –í –ø–ª–∞—Ç–∏–Ω–µ –±–æ—Ç –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ –≤—ã–±–∏—Ä–∞–µ—Ç –ª—É—á—à–∏–π —Ö–æ–¥
        const topMoves = moves.slice(0, 1);
        chosen = topMoves[0];
      } else if (ratingData.currentDivision === 'gold') {
        // –í –∑–æ–ª–æ—Ç–µ –±–æ—Ç –≤—ã–±–∏—Ä–∞–µ—Ç –∏–∑ —Ç–æ–ø-2
        const topMoves = moves.slice(0, 2);
        chosen = topMoves[Math.floor(Math.random() * topMoves.length)];
      } else {
        // –í —Å–µ—Ä–µ–±—Ä–µ –±–æ—Ç –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å —á—É—Ç—å —Ö—É–¥—à–∏–π —Ö–æ–¥ (–∏–∑ —Ç–æ–ø-3)
        const topMoves = moves.slice(0, 3);
        chosen = topMoves[Math.floor(Math.random() * topMoves.length)];
      }

      activateReactor(chosen.r, chosen.c, 2);
      moveCount++;
      currentPlayer = 'human';
      if (moveCount < TOTAL_MOVES) {
        document.getElementById('status').textContent = '–¢–≤–æ–π —Ö–æ–¥ ‚Äî –ø–æ—Å—Ç–∞–≤—å —Ä–µ–∞–∫—Ç–æ—Ä';
      }
      render();
    }

    function resetToStart() {
      document.getElementById('game-screen').classList.remove('active');
      document.getElementById('start-screen').classList.add('active');
      // Reset the dice to its initial state
      const dice = document.getElementById('dice');
      dice.textContent = '?';
      dice.style.color = 'white';
      dice.className = 'dice'; // Remove animate class if it was there
      // Also throw the dice to start the new game
      setTimeout(startToss, 100);
    }

    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('active');
      if (modalId === 'profile-modal') {
        renderStats();
      }
    }

    function togglePatch(patchId) {
      const content = document.getElementById(patchId);
      const arrow = document.getElementById(`arrow-${patchId}`);
      content.classList.toggle('open');
      arrow.style.transform = content.classList.contains('open') ? 'rotate(180deg)' : 'rotate(0deg)';
    }

    function toggleInfo(sectionId) {
      const content = document.getElementById(sectionId);
      const arrow = document.getElementById(`arrow-${sectionId}`);
      content.classList.toggle('open');
      arrow.style.transform = content.classList.contains('open') ? 'rotate(180deg)' : 'rotate(0deg)';
    }

    // –†–µ–π—Ç–∏–Ω–≥–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞
    let ratingData = {
      currentDivision: 'silver',
      ratings: {
        silver: 1000,
        gold: 1300,
        platinum: 1600
      },
      winrates: {
        silver: 0,
        gold: 0,
        platinum: 0
      },
      games: {
        silver: { wins: 0, total: 0 },
        gold: { wins: 0, total: 0 },
        platinum: { wins: 0, total: 0 }
      },
      seasonEndDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000) // 7 –¥–Ω–µ–π –æ—Ç —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã
    };

    function goToRatingScreen() {
      if (!currentUser) {
        showNotification("–û—à–∏–±–∫–∞", "–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Å—Ç—è");
        return;
      }
      document.getElementById('start-screen').classList.remove('active');
      document.getElementById('rating-screen').classList.add('active');
      updateRatingDisplay();
    }

    function updateRatingDisplay() {
      // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–∏–≤–∏–∑–∏–æ–Ω–∞
      document.getElementById('silver-rating').textContent = ratingData.ratings.silver;
      document.getElementById('gold-rating').textContent = ratingData.ratings.gold;
      document.getElementById('platinum-rating').textContent = ratingData.ratings.platinum;
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–Ω—Ä–µ–π—Ç—ã
      const silverWinrate = ratingData.games.silver.total ? 
        Math.round((ratingData.games.silver.wins / ratingData.games.silver.total) * 100) : 0;
      const goldWinrate = ratingData.games.gold.total ? 
        Math.round((ratingData.games.gold.wins / ratingData.games.gold.total) * 100) : 0;
      const platinumWinrate = ratingData.games.platinum.total ? 
        Math.round((ratingData.games.platinum.wins / ratingData.games.platinum.total) * 100) : 0;
        
      document.getElementById('silver-winrate').textContent = `${silverWinrate}%`;
      document.getElementById('gold-winrate').textContent = `${goldWinrate}%`;
      document.getElementById('platinum-winrate').textContent = `${platinumWinrate}%`;
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–π–º–µ—Ä —Å–µ–∑–æ–Ω–∞
      updateSeasonTimer();
    }

    function updateSeasonTimer() {
      const now = new Date();
      const diff = ratingData.seasonEndDate - now;
      
      if (diff > 0) {
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        document.getElementById('season-timer').textContent = `${days} –¥–Ω. ${hours} —á.`;
      } else {
        document.getElementById('season-timer').textContent = '–°–µ–∑–æ–Ω –∑–∞–≤–µ—Ä—à–µ–Ω!';
      }
    }

    function startRatingGame(division) {
      ratingData.currentDivision = division;
      document.getElementById('rating-screen').classList.remove('active');
      document.getElementById('game-screen').classList.add('active');
      
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–≥—Ä—É —Å –±–æ—Ç–æ–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥–∏–≤–∏–∑–∏–æ–Ω–∞
      initRatingGame(division);
    }

    function initRatingGame(division) {
      board = Array(SIZE).fill().map(() => Array(SIZE).fill(0));
      reactors = Array(SIZE).fill().map(() => Array(SIZE).fill(false));
      moveCount = 0;
      gameActive = true;
      
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–µ—Ä–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞ (–≤ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤–æ–º —Ä–µ–∂–∏–º–µ –≤—Å–µ–≥–¥–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç —á–µ–ª–æ–≤–µ–∫)
      currentPlayer = 'human';

      const statusEl = document.getElementById('status');
      statusEl.textContent = '–¢–≤–æ–π —Ö–æ–¥ ‚Äî –ø–æ—Å—Ç–∞–≤—å —Ä–µ–∞–∫—Ç–æ—Ä';
      render();
    }

    function endRatingGame(result) {
      gameActive = false;
      const statusEl = document.getElementById('status');
      let resultType = 'draw';
      let ratingChange = 0;
      
      const youScore = document.getElementById('you-score').textContent;
      const botScore = document.getElementById('bot-score').textContent;
      
      if (parseInt(youScore) > parseInt(botScore)) {
        statusEl.textContent = 'üèÜ –ü–æ–±–µ–¥–∞!';
        resultType = 'win';
        
        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥–∏–≤–∏–∑–∏–æ–Ω–∞
        switch(ratingData.currentDivision) {
          case 'silver':
            ratingChange = 10;
            break;
          case 'gold':
            ratingChange = 15;
            break;
          case 'platinum':
            ratingChange = 20;
            break;
        }
        
        ratingData.ratings[ratingData.currentDivision] += ratingChange;
        ratingData.games[ratingData.currentDivision].wins++;
      } else if (parseInt(botScore) > parseInt(youScore)) {
        statusEl.textContent = 'üíî –ü–æ—Ä–∞–∂–µ–Ω–∏–µ.';
        resultType = 'loss';
        
        // –®—Ç—Ä–∞—Ñ –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ –ø—Ä–∏ –ø–æ—Ä–∞–∂–µ–Ω–∏–∏
        switch(ratingData.currentDivision) {
          case 'silver':
            ratingChange = -8;
            break;
          case 'gold':
            ratingChange = -12;
            break;
          case 'platinum':
            ratingChange = -15;
            break;
        }
        
        ratingData.ratings[ratingData.currentDivision] += ratingChange;
      } else {
        statusEl.textContent = 'ü§ù –ù–∏—á—å—è!';
        resultType = 'draw';
      }
      
      ratingData.games[ratingData.currentDivision].total++;
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–≤—ã—à–µ–Ω–∏–µ/–ø–æ–Ω–∏–∂–µ–Ω–∏–µ –¥–∏–≤–∏–∑–∏–æ–Ω–∞
      checkDivisionChange();
      
      playSound('result');
      updateRatingDisplay();
    }

    function checkDivisionChange() {
      const currentRating = ratingData.ratings[ratingData.currentDivision];
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É –¥–∏–≤–∏–∑–∏–æ–Ω–∞–º–∏
      if (ratingData.currentDivision === 'silver' && currentRating >= 1200) {
        showNotification("–ü–æ–≤—ã—à–µ–Ω–∏–µ!", "–í—ã –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –≤ –¥–∏–≤–∏–∑–∏–æ–Ω –ó–û–õ–û–¢–û!");
        ratingData.currentDivision = 'gold';
      } else if (ratingData.currentDivision === 'gold' && currentRating >= 1500) {
        showNotification("–ü–æ–≤—ã—à–µ–Ω–∏–µ!", "–í—ã –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –≤ –¥–∏–≤–∏–∑–∏–æ–Ω –ü–õ–ê–¢–ò–ù–ê!");
        ratingData.currentDivision = 'platinum';
      } else if (ratingData.currentDivision === 'gold' && currentRating < 1100) {
        showNotification("–ü–æ–Ω–∏–∂–µ–Ω–∏–µ", "–í—ã –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –≤ –¥–∏–≤–∏–∑–∏–æ–Ω –°–ï–†–ï–ë–†–û!");
        ratingData.currentDivision = 'silver';
      } else if (ratingData.currentDivision === 'platinum' && currentRating < 1400) {
        showNotification("–ü–æ–Ω–∏–∂–µ–Ω–∏–µ", "–í—ã –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –≤ –¥–∏–≤–∏–∑–∏–æ–Ω –ó–û–õ–û–¢–û!");
        ratingData.currentDivision = 'gold';
      }
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è initRatingGame
    function initRatingGame(division) {
      board = Array(SIZE).fill().map(() => Array(SIZE).fill(0));
      reactors = Array(SIZE).fill().map(() => Array(SIZE).fill(false));
      moveCount = 0;
      gameActive = true;
      
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–µ—Ä–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞ (–≤ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤–æ–º —Ä–µ–∂–∏–º–µ –≤—Å–µ–≥–¥–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç —á–µ–ª–æ–≤–µ–∫)
      currentPlayer = 'human';

      const statusEl = document.getElementById('status');
      statusEl.textContent = '–¢–≤–æ–π —Ö–æ–¥ ‚Äî –ø–æ—Å—Ç–∞–≤—å —Ä–µ–∞–∫—Ç–æ—Ä';
      render();
    }

    // –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è render –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ–π—Ç–∏–Ω–≥–æ–≤–æ–π –∏–≥—Ä—ã
    function render() {
      const boardEl = document.getElementById('board');
      boardEl.innerHTML = '';
      let youScore = 0, botScore = 0;

      for (let r = 0; r < SIZE; r++) {
        for (let c = 0; c < SIZE; c++) {
          const cell = document.createElement('div');
          cell.className = 'cell';
          if (board[r][c] === 1) {
            cell.classList.add('player1');
            youScore++;
          } else if (board[r][c] === 2) {
            cell.classList.add('player2');
            botScore++;
          }
          if (reactors[r][c]) cell.classList.add('reactor');

          if (gameActive && board[r][c] === 0 && moveCount < TOTAL_MOVES && currentPlayer === 'human') {
            cell.onclick = () => playerMove(r, c);
          }
          boardEl.appendChild(cell);
        }
      }

      document.getElementById('you-score').textContent = youScore;
      document.getElementById('bot-score').textContent = botScore;

      if (moveCount >= TOTAL_MOVES && gameActive) {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤–æ–π –∏–≥—Ä–æ–π
        if (document.getElementById('rating-screen').classList.contains('active') || 
            ratingData.currentDivision) {
          endRatingGame(); // –í—ã–∑—ã–≤–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ–π—Ç–∏–Ω–≥–æ–≤–æ–π –∏–≥—Ä—ã
        } else {
          // –û–±—ã—á–Ω–∞—è –∏–≥—Ä–∞ - –∑–∞–≤–µ—Ä—à–∞–µ–º –∫–∞–∫ –æ–±—ã—á–Ω–æ
          gameActive = false;
          const statusEl = document.getElementById('status');
          if (youScore > botScore) {
            statusEl.textContent = 'üèÜ –ü–æ–±–µ–¥–∞!';
          } else if (botScore > youScore) {
            statusEl.textContent = 'üíî –ü–æ—Ä–∞–∂–µ–Ω–∏–µ.';
          } else {
            statusEl.textContent = 'ü§ù –ù–∏—á—å—è!';
          }
          playSound('result');
        }
      }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
    document.getElementById('google-btn').onclick = loginWithGoogle;
    document.getElementById('profile-btn').onclick = () => {
      if (!currentUser) {
        showNotification("–û—à–∏–±–∫–∞", "–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Å—Ç—è");
        return;
      }
      document.getElementById('profile-modal').classList.add('active');
    };
    // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (settings, changelog –∏ —Ç.–¥.) ‚Äî –∫–∞–∫ –≤ v0.3.1

    document.getElementById('settings-btn').onclick = () => {
      if (!currentUser) {
        showNotification("–û—à–∏–±–∫–∞", "–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Å—Ç—è");
        return;
      }
      document.getElementById('settings-modal').classList.add('active');
    };
    document.getElementById('changelog-btn').onclick = () => {
      document.getElementById('changelog-modal').classList.add('active');
    };
    document.getElementById('support-btn').onclick = () => {
      document.getElementById('support-modal').classList.add('active');
    };
    document.getElementById('info-btn').onclick = () => {
      document.getElementById('info-modal').classList.add('active');
    };

    document.querySelectorAll('.modal-overlay').forEach(overlay => {
      overlay.addEventListener('click', (e) => {
        if (e.target === overlay) {
          overlay.classList.remove('active');
        }
      });
    });

    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    loadUser();

    // –ü–æ–¥–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    renderStats();
    
    // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞
    updateRatingDisplay();

    // üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è Google OAuth (–≤ –∫–æ–Ω—Å–æ–ª–∏)
    console.log(
      "%c‚ö†Ô∏è Google OAuth: –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ 400 ‚Äî –¥–æ–±–∞–≤—å—Ç–µ –≤ Google Cloud Console:\n" +
      "http://localhost\nhttp://localhost:8000\nhttp://127.0.0.1\nhttps://–≤–∞—à-–¥–æ–º–µ–Ω.—Ä—É",
      "color: #ff6b6b; font-weight: bold;"
    );
  </script>
</body>
</html>
