<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>REACTOR ‚Äî –£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #0d0d1a, #1a1a2e);
      color: white;
      font-family: 'Segoe UI', sans-serif;
      text-align: center;
      overflow: hidden;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      touch-action: manipulation;
      min-height: 100vh;
      position: relative;
    }

    body::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 10% 20%, rgba(77, 238, 234, 0.1) 0%, transparent 40%),
                  radial-gradient(circle at 90% 80%, rgba(255, 107, 107, 0.1) 0%, transparent 40%);
      pointer-events: none;
      z-index: 1;
    }

    .demo-banner {
      background: linear-gradient(45deg, #ff3b30, #ff6b6b);
      color: white;
      padding: 8px;
      font-weight: bold;
      font-size: 14px;
      letter-spacing: 0.5px;
      text-shadow: 0 1px 2px rgba(0,0,0,0.3);
      position: relative;
      z-index: 30;
      text-align: center;
      box-shadow: 0 2px 10px rgba(255, 59, 48, 0.3);
    }

    #top-ui {
      position: absolute;
      top: 42px;
      right: 12px;
      display: flex;
      gap: 12px;
      z-index: 20;
    }

    .icon-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(30, 30, 46, 0.8);
      border: 2px solid transparent;
      background-image: linear-gradient(rgba(13, 13, 26, 1), rgba(13, 13, 26, 1)), 
                        linear-gradient(45deg, #4deeea, #ff6b6b);
      background-origin: border-box;
      background-clip: content-box, border-box;
      color: white;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      backdrop-filter: blur(4px);
      transition: all 0.3s ease;
      padding: 0;
      position: relative;
      overflow: hidden;
    }

    .icon-btn::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(255,255,255,0.2), transparent);
      transform: rotate(45deg);
      transition: all 0.3s ease;
      z-index: -1;
    }

    .icon-btn:hover {
      transform: scale(1.15) rotate(5deg);
      box-shadow: 0 0 20px rgba(77, 238, 234, 0.5);
    }

    .icon-btn:hover::before {
      transform: rotate(45deg) translate(20%, 20%);
    }

    .icon-btn:focus {
      outline: none;
    }

    .screen {
      display: none;
      width: 100vw;
      height: 100vh;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 20px;
      box-sizing: border-box;
      position: absolute;
      top: 0;
      left: 0;
    }
    .active { display: flex !important; }

    h1 {
      font-size: 36px;
      background: linear-gradient(45deg, #4deeea, #ff6b6b);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 20px;
      z-index: 5;
      text-shadow: 0 0 20px rgba(77, 238, 234, 0.3);
      font-weight: 700;
      letter-spacing: 1px;
    }

    .subtitle {
      font-size: 18px;
      color: #ccc;
      margin-bottom: 30px;
      max-width: 500px;
      line-height: 1.5;
      text-shadow: 0 1px 2px rgba(0,0,0,0.5);
    }

    .dice {
      width: 100px;
      height: 100px;
      background: linear-gradient(145deg, #1e1e2e, #2a2a3e);
      border: 3px solid #4deeea;
      border-radius: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 48px;
      font-weight: bold;
      margin: 30px 0;
      z-index: 5;
      position: relative;
      box-shadow: 0 0 20px rgba(77, 238, 234, 0.3);
      transition: all 0.3s ease;
    }

    .dice:hover {
      transform: scale(1.05);
      box-shadow: 0 0 30px rgba(77, 238, 234, 0.5);
    }

    .dice.animate {
      animation: toss 2.2s cubic-bezier(0.3, 0.8, 0.5, 1) forwards;
    }

    @keyframes toss {
      0% { transform: translateY(0) rotate(0deg) scale(1); opacity: 1; }
      30% { transform: translateY(-120px) rotate(180deg) scale(1.2); }
      60% { transform: translateY(-60px) rotate(360deg) scale(1.1); }
      80% { transform: translateY(-20px) rotate(540deg) scale(1.05); }
      100% { transform: translateY(0) rotate(720deg) scale(1); opacity: 1; }
    }

    button {
      padding: 12px 30px;
      background: linear-gradient(45deg, #4deeea, #ff6b6b);
      border: none;
      border-radius: 12px;
      color: #000;
      font-weight: bold;
      font-size: 16px;
      cursor: pointer;
      margin-top: 20px;
      z-index: 5;
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(77, 238, 234, 0.4);
    }

    button::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
      transform: rotate(45deg);
      transition: all 0.5s ease;
      z-index: -1;
    }

    button:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 6px 20px rgba(77, 238, 234, 0.6);
    }

    button:hover::before {
      transform: rotate(45deg) translate(20%, 20%);
    }

    button:active {
      transform: translateY(1px) scale(0.98);
    }

    #board {
      display: grid;
      grid-template-columns: repeat(7, min(52px, calc((100vw - 40px) / 7)));
      grid-gap: 4px;
      margin: 12px auto;
      max-width: calc(7 * min(52px, (100vw - 40px) / 7) + 28px);
      position: relative;
      padding: 10px;
      border-radius: 15px;
      background: rgba(20, 20, 36, 0.3);
      box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
    }
    
    .cell {
      width: min(52px, calc((100vw - 40px) / 7 - 4px));
      height: min(52px, calc((100vw - 40px) / 7 - 4px));
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: min(22px, calc((100vw - 40px) / 7 * 0.42));
      cursor: pointer;
      transition: transform 0.2s, background 0.3s, box-shadow 0.3s;
      background: linear-gradient(145deg, #1a1a2a, #252538);
      touch-action: manipulation;
      position: relative;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }
    
    .cell::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
      transform: rotate(45deg);
      transition: all 0.3s ease;
      z-index: -1;
    }
    
    .cell:hover { 
      transform: scale(1.05); 
      box-shadow: 0 0 15px rgba(255, 255, 255, 0.2);
    }
    
    .cell:hover::before {
      transform: rotate(45deg) translate(10%, 10%);
    }
    
    .player1 { 
      background: linear-gradient(145deg, #1e3a8a, #2563eb); 
      color: #bfdbfe; 
      box-shadow: 0 0 10px rgba(30, 58, 138, 0.5);
    }
    
    .player2 { 
      background: linear-gradient(145deg, #991b1b, #dc2626); 
      color: #fecaca; 
      box-shadow: 0 0 10px rgba(153, 27, 27, 0.5);
    }
    
    .reactor::after { 
      content: "‚óè"; 
      font-size: min(20px, calc((100vw - 40px) / 7 * 0.38)); 
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.7);
    }

    /* –£—Å–∏–ª–µ–Ω–Ω–∞—è —Ü–µ–ø–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è */
    .cell.chain {
      animation: chainReaction 0.8s cubic-bezier(0.1, 0.9, 0.4, 1) forwards;
    }
    
    @keyframes chainReaction {
      0% { 
        transform: scale(1); 
        box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.8);
        z-index: 10;
      }
      40% { 
        transform: scale(1.4); 
        box-shadow: 0 0 0 15px rgba(255, 215, 0, 1), 0 0 25px rgba(255, 165, 0, 0.8);
        z-index: 10;
      }
      100% { 
        transform: scale(1); 
        box-shadow: 0 0 0 0 rgba(255, 215, 0, 0);
        z-index: auto;
      }
    }

    #status {
      margin: 14px 0;
      font-size: 20px;
      min-height: 24px;
      font-weight: bold;
      text-shadow: 0 1px 2px rgba(0,0,0,0.5);
      background: linear-gradient(45deg, #4deeea, #ff6b6b);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    #score {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin: 8px 0;
      font-size: 16px;
      position: relative;
      z-index: 5;
    }
    
    .score-box {
      padding: 8px 20px;
      border-radius: 12px;
      background: rgba(30, 30, 46, 0.6);
      border: 2px solid #4deeea;
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    }
    
    .score-box:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(77, 238, 234, 0.4);
    }
    
    .you { border-color: #4deeea; }
    .bot { border-color: #ff6b6b; }

    #footer {
      margin: 20px auto;
      font-size: 12px;
      color: #666;
      max-width: 400px;
      line-height: 1.5;
      text-shadow: 0 1px 2px rgba(0,0,0,0.5);
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(6px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.4s, visibility 0.4s;
    }

    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background: linear-gradient(145deg, #141424, #1a1a2e);
      border: 2px solid #4deeea;
      border-radius: 20px;
      padding: 28px;
      width: 90%;
      max-width: 420px;
      text-align: center;
      box-shadow: 0 0 30px rgba(77, 238, 234, 0.4);
      position: relative;
      transform: scale(0.8);
      transition: transform 0.4s ease;
      border-image: linear-gradient(45deg, #4deeea, #ff6b6b) 1;
    }

    .notification-modal {
      max-width: 340px;
    }
    .notification-modal h2 {
      font-size: 20px;
      margin: 0 0 12px;
      color: #4deeea;
      text-shadow: 0 0 10px rgba(77, 238, 234, 0.3);
    }
    .notification-modal p {
      font-size: 16px;
      margin: 0;
      color: #ccc;
      line-height: 1.5;
    }

    .modal-overlay.active .modal {
      transform: scale(1);
    }

    /* Changelog & Info Accordions */
    .patch-entry,
    .info-section {
      margin: 14px 0;
      border: 1px solid #333;
      border-radius: 12px;
      overflow: hidden;
      background: rgba(30, 30, 46, 0.4);
    }

    .patch-header,
    .info-header {
      padding: 14px 18px;
      background: linear-gradient(90deg, rgba(77, 238, 234, 0.15), rgba(255, 107, 107, 0.15));
      color: #4deeea;
      font-weight: bold;
      font-size: 16px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: background 0.3s;
    }

    .patch-header:hover,
    .info-header:hover {
      background: linear-gradient(90deg, rgba(77, 238, 234, 0.25), rgba(255, 107, 107, 0.25));
    }

    .patch-arrow,
    .info-arrow {
      width: 18px;
      height: 18px;
      transition: transform 0.4s ease;
      fill: #4deeea;
    }

    .patch-content,
    .info-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.5s ease, padding 0.5s ease;
      background: rgba(20, 20, 36, 0.7);
      color: #ccc;
      padding: 0 18px;
    }

    .patch-content.open,
    .info-content.open {
      max-height: 500px;
      padding: 18px;
    }

    .patch-content ul,
    .info-content ul {
      text-align: left;
      padding-left: 20px;
      margin: 0;
      line-height: 1.6;
    }

    .patch-content li,
    .info-content li {
      margin-bottom: 8px;
    }

    .info-content {
      text-align: left;
      line-height: 1.5;
    }

    .info-content p {
      margin: 8px 0;
    }

    .close-modal {
      position: absolute;
      top: 14px;
      right: 14px;
      background: none;
      border: none;
      width: 28px;
      height: 28px;
      cursor: pointer;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: background 0.3s;
      z-index: 10;
    }

    .close-modal:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .close-modal svg {
      width: 18px;
      height: 18px;
      fill: #aaa;
      transition: fill 0.3s;
    }

    .close-modal:hover svg {
      fill: white;
    }

    /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
    .stats-box {
      margin-top: 18px;
      padding: 16px;
      background: rgba(30, 30, 46, 0.6);
      border-radius: 12px;
      text-align: left;
      border: 1px solid #4deeea;
    }
    .stats-row {
      display: flex;
      justify-content: space-between;
      margin: 8px 0;
      padding: 4px 0;
    }
    .stats-label { color: #aaa; }
    .stats-value { font-weight: bold; font-size: 16px; }
    .winrate-good { color: #4deeea; text-shadow: 0 0 10px rgba(77, 238, 234, 0.5); }
    .winrate-bad { color: #ff6b6b; text-shadow: 0 0 10px rgba(255, 107, 107, 0.5); }

    /* –ê–≤–∞—Ç–∞—Ä */
    #user-avatar {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background: linear-gradient(45deg, #4deeea, #ff6b6b);
      margin: 0 auto 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      font-weight: bold;
      color: white;
      box-shadow: 0 0 20px rgba(77, 238, 234, 0.4);
      border: 2px solid #4deeea;
    }

    /* –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ */
    #logout-btn {
      background: linear-gradient(45deg, #555, #777);
      margin-top: 12px;
    }

    /* –ù–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
    .auth-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 18px;
      max-width: 360px;
      margin: 30px auto 0;
    }

    .auth-btn {
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInUp 0.7s forwards;
    }
    .auth-btn:nth-child(1) { animation-delay: 0.1s; }
    .auth-btn:nth-child(2) { animation-delay: 0.2s; }

    @keyframes fadeInUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .google-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      width: 100%;
      padding: 18px;
      background: linear-gradient(45deg, #4285F4, #357ae8);
      color: white;
      font-weight: bold;
      font-size: 16px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 6px 15px rgba(66, 133, 244, 0.4);
      position: relative;
      overflow: hidden;
    }
    .google-btn::before {
      content: '';
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: linear-gradient(135deg, rgba(255,255,255,0.2), transparent);
      opacity: 0;
      transition: opacity 0.4s;
    }
    .google-btn:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(66, 133, 244, 0.6);
      background: linear-gradient(45deg, #357ae8, #2a69d4);
    }
    .google-btn:hover::before {
      opacity: 1;
    }
    .google-btn svg { flex-shrink: 0; }

    .guest-btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(45deg, #2d2d3d, #3a3a4a);
      color: #ccc;
      font-size: 16px;
      border: 1px solid #404050;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s;
    }
    .guest-btn:hover {
      background: linear-gradient(45deg, #353545, #424252);
      color: #e0e0ff;
      border-color: #505060;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    /* –ò–∫–æ–Ω–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ */
    .spinner {
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-top: 2px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      display: none;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .google-btn.loading .spinner {
      display: block;
    }
    .google-btn.loading span {
      opacity: 0;
    }
    
    /* –ê–Ω–∏–º–∞—Ü–∏—è —Ñ–æ–Ω–∞ */
    .background-animation {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      opacity: 0.1;
      pointer-events: none;
    }
    
    .particle {
      position: absolute;
      border-radius: 50%;
      background: rgba(77, 238, 234, 0.5);
      animation: float 15s infinite linear;
    }
    
    @keyframes float {
      0% {
        transform: translateY(0) translateX(0) rotate(0deg);
        opacity: 0;
      }
      10% {
        opacity: 1;
      }
      90% {
        opacity: 1;
      }
      100% {
        transform: translateY(-100vh) translateX(100px) rotate(360deg);
        opacity: 0;
      }
    }
    
    /* –≠—Ñ—Ñ–µ–∫—Ç—ã –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ —è—á–µ–π–∫–∏ */
    .cell.player1:hover {
      box-shadow: 0 0 20px rgba(30, 58, 138, 0.8);
    }
    
    .cell.player2:hover {
      box-shadow: 0 0 20px rgba(153, 27, 27, 0.8);
    }
    
    /* –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã */
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    .pulse {
      animation: pulse 2s infinite;
    }
  </style>
</head>
<body>
  <div class="background-animation" id="background-animation"></div>
  
  <div class="demo-banner">
    –£–õ–£–ß–®–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
  </div>

  <div id="top-ui">
    <button id="profile-btn" class="icon-btn" title="Profile">üë§</button>
    <button id="settings-btn" class="icon-btn" title="Settings">‚öôÔ∏è</button>
    <button id="changelog-btn" class="icon-btn" title="Changelog">üìñ</button>
    <button id="support-btn" class="icon-btn" title="Support">üí¨</button>
    <button id="info-btn" class="icon-btn" title="Info">‚ùì</button>
  </div>

  <div id="main-menu" class="screen active">
    <h1 class="pulse">REACTOR</h1>
    <p class="subtitle">
      –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫—É—é –∏–≥—Ä—É, –≥–¥–µ –∫–∞–∂–¥—ã–π —Ö–æ–¥ —Ä–µ—à–∞–µ—Ç –∏—Å—Ö–æ–¥ –±–∏—Ç–≤—ã –∑–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å!<br>
      –ü–æ—Å—Ç—Ä–æ–π—Ç–µ —Ä–µ–∞–∫—Ç–æ—Ä—ã, –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–π—Ç–µ –∫–ª–µ—Ç–∫–∏ –∏ –æ–±—ã–≥—Ä–∞–π—Ç–µ –±–æ—Ç–∞ –∑–∞ 14 —Ö–æ–¥–æ–≤.
    </p>
    <div class="auth-container">
      <button id="google-btn" class="google-btn auth-btn">
        <svg width="20" height="20" viewBox="0 0 24 24"><path fill="#fff" d="M12.24 10.285V14.4h6.806c-.275 1.765-2.056 5.174-6.806 5.174-4.095 0-7.439-3.389-7.439-7.574s3.345-7.574 7.439-7.574c2.33 0 3.891.989 4.785 1.849l3.234-3.138C18.189 1.186 15.479 0 12.24 0c-6.635 0-12 5.365-12 12s5.365 12 12 12c6.926 0 11.52-4.869 11.52-11.726 0-.788-.085-1.39-.189-1.989H12.24z"/></svg>
        <span>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å Google</span>
        <div class="spinner"></div>
      </button>
      <button onclick="loginAsGuest()" class="guest-btn auth-btn">
        –ò–≥—Ä–∞—Ç—å –∫–∞–∫ –≥–æ—Å—Ç—å
      </button>
    </div>
    <div id="user-info" style="display:none;margin-top:30px">
      <div id="user-avatar"></div>
      <div id="user-name" style="margin-top:12px;font-weight:bold;font-size:22px"></div>
      <button onclick="goToStartScreen()" style="margin-top:16px;padding:14px 32px;font-size:16px">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
      <button id="logout-btn" onclick="logout()" style="margin-top:12px;padding:12px 28px">–í—ã–π—Ç–∏</button>
    </div>
  </div>

  <div id="start-screen" class="screen">
    <h1>REACTOR</h1>
    <p>–ö—Ç–æ –Ω–∞—á–Ω—ë—Ç –ø–µ—Ä–≤—ã–º?</p>
    <div class="dice" id="dice">?</div>
    <button onclick="startToss()">–ü–æ–¥–±—Ä–æ—Å–∏—Ç—å –∫—É–±–∏–∫</button>
  </div>

  <div id="game-screen" class="screen">
    <h1>REACTOR</h1>
    <div id="score">
      <div class="score-box you">–¢—ã: <span id="you-score">0</span></div>
      <div class="score-box bot">–ë–æ—Ç: <span id="bot-score">0</span></div>
    </div>
    <div id="status">–û–∂–∏–¥–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞...</div>
    <div id="board"></div>
    <div id="controls">
      <button onclick="resetToStart()">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
    </div>
    <div id="footer">
      –ö–∞–∂–¥—ã–π —Ä–µ–∞–∫—Ç–æ—Ä (‚óè) –ø–µ—Ä–µ–∫—Ä–∞—à–∏–≤–∞–µ—Ç —Å–æ—Å–µ–¥–Ω–∏–µ –∫–ª–µ—Ç–∫–∏.<br>
      –ü–æ—Å–ª–µ 14 —Ö–æ–¥–æ–≤ –ø–æ–±–µ–∂–¥–∞–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—â–∏–π –±–æ–ª—å—à–µ.
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
  <div id="profile-modal" class="modal-overlay">
    <div class="modal">
      <button class="close-modal" onclick="closeModal('profile-modal')">
        <svg viewBox="0 0 24 24">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
      </button>
      <h2>–ü—Ä–æ—Ñ–∏–ª—å</h2>
      <div id="profile-stats"></div>
      <button id="profile-logout-btn" onclick="logout()" style="margin-top:16px;background:linear-gradient(45deg, #555, #777)">–í—ã–π—Ç–∏</button>
    </div>
  </div>

  <div id="settings-modal" class="modal-overlay">
    <div class="modal">
      <button class="close-modal" onclick="closeModal('settings-modal')">
        <svg viewBox="0 0 24 24">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
      </button>
      <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
      <p>Soon</p>
    </div>
  </div>

  <div id="changelog-modal" class="modal-overlay">
    <div class="modal">
      <button class="close-modal" onclick="closeModal('changelog-modal')">
        <svg viewBox="0 0 24 24">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
      </button>
      <h2>–°–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π</h2>

      <div class="patch-entry">
        <div class="patch-header" onclick="togglePatch('patch-033')">
          v0.3.3
          <svg class="patch-arrow" id="arrow-033" viewBox="0 0 24 24">
            <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
          </svg>
        </div>
        <div class="patch-content" id="patch-033">
          <ul>
            <li>‚Ä¢ –£–ª—É—á—à–µ–Ω–Ω—ã–π –≤–∏–∑—É–∞–ª—å–Ω—ã–π –¥–∏–∑–∞–π–Ω —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞–º–∏ –∏ –∞–Ω–∏–º–∞—Ü–∏—è–º–∏</li>
            <li>‚Ä¢ –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –∏ —ç—Ñ—Ñ–µ–∫—Ç—ã</li>
            <li>‚Ä¢ –£–ª—É—á—à–µ–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</li>
            <li>‚Ä¢ –î–æ–±–∞–≤–ª–µ–Ω—ã —á–∞—Å—Ç–∏—Ü—ã –∞–Ω–∏–º–∞—Ü–∏–∏ —Ñ–æ–Ω–∞</li>
          </ul>
        </div>
      </div>

      <div class="patch-entry">
        <div class="patch-header" onclick="togglePatch('patch-032')">
          v0.3.2
          <svg class="patch-arrow" id="arrow-032" viewBox="0 0 24 24">
            <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
          </svg>
        </div>
        <div class="patch-content" id="patch-032">
          <ul>
            <li>‚Ä¢ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∞–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–æ–∫</li>
            <li>‚Ä¢ –ò–∫–æ–Ω–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏ –≤—Ö–æ–¥–µ —á–µ—Ä–µ–∑ Google</li>
            <li>‚Ä¢ –û–±–Ω–æ–≤–ª—ë–Ω –¥–∏–∑–∞–π–Ω –∫–Ω–æ–ø–æ–∫ (Google + –≥–æ—Å—Ç—å)</li>
          </ul>
        </div>
      </div>

      <div class="patch-entry">
        <div class="patch-header" onclick="togglePatch('patch-031')">
          v0.3.1
          <svg class="patch-arrow" id="arrow-031" viewBox="0 0 24 24">
            <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
          </svg>
        </div>
        <div class="patch-content" id="patch-031">
          <ul>
            <li>‚Ä¢ –î–æ–±–∞–≤–ª–µ–Ω –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ Google</li>
            <li>‚Ä¢ VK –≤—Ä–µ–º–µ–Ω–Ω–æ —É–±—Ä–∞–Ω</li>
          </ul>
        </div>
      </div>

      <div class="patch-entry">
        <div class="patch-header" onclick="togglePatch('patch-030')">
          v0.3.0
          <svg class="patch-arrow" id="arrow-030" viewBox="0 0 24 24">
            <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
          </svg>
        </div>
        <div class="patch-content" id="patch-030">
          <ul>
            <li>‚Ä¢ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</li>
            <li>‚Ä¢ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã Changelog –∏ Info</li>
            <li>‚Ä¢ –í—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ‚Äî —á–µ—Ä–µ–∑ –∫–∞—Å—Ç–æ–º–Ω—ã–µ –º–æ–¥–∞–ª–∫–∏</li>
          </ul>
        </div>
      </div>

      <div class="patch-entry">
        <div class="patch-header" onclick="togglePatch('patch-021')">
          v0.2.1
          <svg class="patch-arrow" id="arrow-021" viewBox="0 0 24 24">
            <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
          </svg>
        </div>
        <div class="patch-content" id="patch-021">
          <ul>
            <li>‚Ä¢ –ü–æ–ª–µ 7√ó7, 14 —Ö–æ–¥–æ–≤</li>
            <li>‚Ä¢ –¶–µ–ø–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è, –∑–≤—É–∫–∏</li>
          </ul>
        </div>
      </div>

      <div class="patch-entry">
        <div class="patch-header" onclick="togglePatch('patch-02')">
          v0.2
          <svg class="patch-arrow" id="arrow-02" viewBox="0 0 24 24">
            <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
          </svg>
        </div>
        <div class="patch-content" id="patch-02">
          <ul>
            <li>‚Ä¢ –£–ª—É—á—à–µ–Ω–Ω—ã–π –ò–ò-–±–æ—Ç</li>
            <li>‚Ä¢ –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞, –ø—Ä–æ—Ñ–∏–ª—å, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</li>
          </ul>
        </div>
      </div>

      <div class="patch-entry">
        <div class="patch-header" onclick="togglePatch('patch-01')">
          v0.1
          <svg class="patch-arrow" id="arrow-01" viewBox="0 0 24 24">
            <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
          </svg>
        </div>
        <div class="patch-content" id="patch-01">
          <ul>
            <li>‚Ä¢ –ë–∞–∑–æ–≤–∞—è –∏–≥—Ä–∞: 5√ó5, 10 —Ö–æ–¥–æ–≤</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <div id="support-modal" class="modal-overlay">
    <div class="modal">
      <button class="close-modal" onclick="closeModal('support-modal')">
        <svg viewBox="0 0 24 24">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
      </button>
      <h2>–û–Ω–ª–∞–π–Ω-–ø–æ–¥–¥–µ—Ä–∂–∫–∞</h2>
      <p>Soon</p>
    </div>
  </div>

  <div id="info-modal" class="modal-overlay">
    <div class="modal">
      <button class="close-modal" onclick="closeModal('info-modal')">
        <svg viewBox="0 0 24 24">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
      </button>
      <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>

      <div class="info-section">
        <div class="info-header" onclick="toggleInfo('rules')">
          –ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã
          <svg class="info-arrow" id="arrow-rules" viewBox="0 0 24 24">
            <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
          </svg>
        </div>
        <div class="info-content" id="rules">
          <p>‚Ä¢ –ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ: <strong>7√ó7 –∫–ª–µ—Ç–æ–∫</strong>.</p>
          <p>‚Ä¢ –í—Å–µ–≥–æ <strong>14 —Ö–æ–¥–æ–≤</strong> (–ø–æ 7 –Ω–∞ –∏–≥—Ä–æ–∫–∞).</p>
          <p>‚Ä¢ –ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ —Ä–µ–∞–∫—Ç–æ—Ä–∞ (‚óè) –≤—ã –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç–µ:</p>
          <p style="padding-left: 20px;">‚Äî –∫–ª–µ—Ç–∫—É —Å —Ä–µ–∞–∫—Ç–æ—Ä–æ–º,</p>
          <p style="padding-left: 20px;">‚Äî –≤—Å–µ 4 —Å–æ—Å–µ–¥–Ω–∏–µ –∫–ª–µ—Ç–∫–∏.</p>
          <p>‚Ä¢ –ü–æ–±–µ–∂–¥–∞–µ—Ç –∏–≥—Ä–æ–∫, –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—â–∏–π –±–æ–ª—å—à–µ –∫–ª–µ—Ç–æ–∫ –ø–æ—Å–ª–µ 14 —Ö–æ–¥–æ–≤.</p>
        </div>
      </div>

      <div class="info-section">
        <div class="info-header" onclick="toggleInfo('agreement')">
          –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ
          <svg class="info-arrow" id="arrow-agreement" viewBox="0 0 24 24">
            <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
          </svg>
        </div>
        <div class="info-content" id="agreement">
          <p>‚Ä¢ –î–∞–Ω–Ω–∞—è –¥–µ–º–æ-–≤–µ—Ä—Å–∏—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è ¬´–∫–∞–∫ –µ—Å—Ç—å¬ª.</p>
          <p>‚Ä¢ –ê–≤—Ç–æ—Ä –Ω–µ –Ω–µ—Å—ë—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ —É—â–µ—Ä–±.</p>
          <p>‚Ä¢ –ò–≥—Ä–∞ –Ω–µ —Å–æ–±–∏—Ä–∞–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.</p>
          <p>‚Ä¢ –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã. –ó–∞–ø—Ä–µ—â–µ–Ω–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ.</p>
        </div>
      </div>

      <div class="info-section">
        <div class="info-header" onclick="toggleInfo('about')">
          –û –ø—Ä–æ–µ–∫—Ç–µ
          <svg class="info-arrow" id="arrow-about" viewBox="0 0 24 24">
            <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
          </svg>
        </div>
        <div class="info-content" id="about">
          <p>–ò–≥—Ä–∞ <strong>REACTOR</strong> —Å–æ–∑–¥–∞–Ω–∞ –∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç <strong>G3laZi Project</strong>.</p>
          <p>–í–µ—Ä—Å–∏—è: v0.3.3 (—É–ª—É—á—à–µ–Ω–Ω–∞—è)</p>
          <p>¬© 2025 G3laZi Project. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
  <div id="notification-modal" class="modal-overlay">
    <div class="modal notification-modal">
      <button class="close-modal" onclick="closeNotification()">
        <svg viewBox="0 0 24 24">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
      </button>
      <h2 id="notification-title">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</h2>
      <p id="notification-text">–°–æ–æ–±—â–µ–Ω–∏–µ</p>
    </div>
  </div>

  <script>
    const SIZE = 7;
    const TOTAL_MOVES = 14;
    let board, reactors, moveCount, gameActive, currentPlayer, currentUser = null;

    // –°–æ–∑–¥–∞–Ω–∏–µ –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —á–∞—Å—Ç–∏—Ü —Ñ–æ–Ω–∞
    function createBackgroundParticles() {
      const container = document.getElementById('background-animation');
      container.innerHTML = '';
      
      for (let i = 0; i < 20; i++) {
        const particle = document.createElement('div');
        particle.classList.add('particle');
        
        // –°–ª—É—á–∞–π–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —á–∞—Å—Ç–∏—Ü—ã
        const size = Math.random() * 20 + 5;
        const posX = Math.random() * 100;
        const posY = Math.random() * 100 + 100; // –ù–∞—á–∏–Ω–∞–µ–º –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ —ç–∫—Ä–∞–Ω–∞
        const duration = Math.random() * 20 + 10;
        const delay = Math.random() * 5;
        const hue = Math.random() > 0.5 ? 180 : 0; // –ì–æ–ª—É–±–æ–π –∏–ª–∏ –∫—Ä–∞—Å–Ω—ã–π
        
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        particle.style.left = `${posX}%`;
        particle.style.top = `${posY}%`;
        particle.style.background = `hsla(${hue}, 70%, 60%, 0.5)`;
        particle.style.animation = `float ${duration}s linear ${delay}s infinite`;
        
        container.appendChild(particle);
      }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–∞—Å—Ç–∏—Ü –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    window.addEventListener('load', createBackgroundParticles);

    // –ó–≤—É–∫–∏
    let audioInitialized = false;
    function initAudio() {
      if (audioInitialized) return;
      audioInitialized = true;
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const oscillator = ctx.createOscillator();
      const gain = ctx.createGain();
      oscillator.connect(gain);
      gain.connect(ctx.destination);
      gain.gain.setValueAtTime(0.001, ctx.currentTime);
      oscillator.start();
      oscillator.stop(ctx.currentTime + 0.1);
    }
    document.body.addEventListener('click', initAudio, { once: true });
    document.body.addEventListener('touchstart', initAudio, { once: true });

    function playSound(id) {
      if (!audioInitialized) return;
      const sound = document.getElementById(`sound-${id}`);
      if (sound) {
        sound.currentTime = 0;
        sound.play().catch(e => console.log("Audio play prevented:", e));
      }
    }

    // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    function showNotification(title, text) {
      document.getElementById('notification-title').textContent = title;
      document.getElementById('notification-text').textContent = text;
      document.getElementById('notification-modal').classList.add('active');
    }
    function closeNotification() {
      document.getElementById('notification-modal').classList.remove('active');
    }

    // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    function saveUser(user) {
      localStorage.setItem('reactor_user', JSON.stringify(user));
      currentUser = user;
      updateUI();
    }
    function loadUser() {
      const saved = localStorage.getItem('reactor_user');
      currentUser = saved ? JSON.parse(saved) : null;
      updateUI();
    }
    function updateUI() {
      const authContainer = document.querySelector('.auth-container');
      const userInfo = document.getElementById('user-info');
      const userName = document.getElementById('user-name');
      const avatar = document.getElementById('user-avatar');

      if (currentUser) {
        authContainer.style.display = 'none';
        userInfo.style.display = 'block';
        userName.textContent = currentUser.name || '–ò–≥—Ä–æ–∫';
        avatar.textContent = (currentUser.name || '?')[0].toUpperCase();
        avatar.style.background = currentUser.photo 
          ? `linear-gradient(45deg, #4deeea, #ff6b6b), url(${currentUser.photo}) center/cover no-repeat` 
          : 'linear-gradient(45deg, #4deeea, #ff6b6b)';
      } else {
        authContainer.style.display = 'flex';
        userInfo.style.display = 'none';
      }
      renderStats();
    }

    // –í—ã—Ö–æ–¥
    function logout() {
      localStorage.removeItem('reactor_user');
      currentUser = null;
      updateUI();
      document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('active'));
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById('main-menu').classList.add('active');
    }

    // Google
    function loginWithGoogle() {
      const btn = document.getElementById('google-btn');
      btn.classList.add('loading');
      
      const client = google.accounts.oauth2.initTokenClient({
        client_id: '712124061862-fun5umqbl2u9d4fsnve4pi4h2g4b21ug.apps.googleusercontent.com',
        scope: 'https://www.googleapis.com/auth/userinfo.profile',
        callback: (tokenResponse) => {
          btn.classList.remove('loading');
          if (tokenResponse.access_token) {
            fetch('https://www.googleapis.com/oauth2/v3/userinfo', {
              headers: { Authorization: `Bearer ${tokenResponse.access_token}` }
            })
            .then(res => res.json())
            .then(user => {
              saveUser({
                id: 'google_' + user.sub,
                name: user.name || user.given_name || 'Google User',
                photo: user.picture || null
              });
            })
            .catch(err => {
              console.error("Google login error:", err);
              showNotification("–û—à–∏–±–∫–∞", "–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google");
            });
          } else {
            showNotification("–û—à–∏–±–∫–∞", "–û—Ç–º–µ–Ω–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º");
          }
        }
      });
      client.requestAccessToken();
    }

    // –ì–æ—Å—Ç—å
    function loginAsGuest() {
      const guestName = prompt("–ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç?", "–ò–≥—Ä–æ–∫");
      if (guestName) {
        saveUser({
          id: 'guest_' + Date.now(),
          name: guestName.trim() || '–ò–≥—Ä–æ–∫',
          isGuest: true
        });
      }
    }

    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    function getStatsKey() {
      return currentUser ? `reactor_stats_${currentUser.id}` : 'reactor_stats_guest';
    }
    function loadStats() {
      const key = getStatsKey();
      const saved = localStorage.getItem(key);
      return saved ? JSON.parse(saved) : { wins: 0, losses: 0, draws: 0 };
    }
    function saveStats(stats) {
      const key = getStatsKey();
      localStorage.setItem(key, JSON.stringify(stats));
    }
    function updateStats(result) {
      const stats = loadStats();
      if (result === 'win') stats.wins++;
      else if (result === 'loss') stats.losses++;
      else stats.draws++;
      saveStats(stats);
      renderStats();
    }
    function renderStats() {
      const stats = loadStats();
      const el = document.getElementById('profile-stats');
      if (el) {
        const total = stats.wins + stats.losses + stats.draws;
        const winrate = total ? Math.round((stats.wins / total) * 100) : 0;
        const name = currentUser ? currentUser.name : '–ì–æ—Å—Ç—å';
        el.innerHTML = `
          <div class="stats-box">
            <div class="stats-row">
              <span class="stats-label">üë§ –ò–≥—Ä–æ–∫:</span>
              <span class="stats-value">${name}</span>
            </div>
            <div class="stats-row">
              <span class="stats-label">üèÜ –ü–æ–±–µ–¥:</span>
              <span class="stats-value">${stats.wins}</span>
            </div>
            <div class="stats-row">
              <span class="stats-label">üíî –ü–æ—Ä–∞–∂–µ–Ω–∏–π:</span>
              <span class="stats-value">${stats.losses}</span>
            </div>
            <div class="stats-row">
              <span class="stats-label">ü§ù –ù–∏—á—å–∏—Ö:</span>
              <span class="stats-value">${stats.draws}</span>
            </div>
            <div class="stats-row">
              <span class="stats-label">üìà –í–∏–Ω—Ä–µ–π—Ç:</span>
              <span class="stats-value ${winrate >= 50 ? 'winrate-good' : 'winrate-bad'}">${winrate}%</span>
            </div>
            <div class="stats-row">
              <span class="stats-label">üìä –í—Å–µ–≥–æ –∏–≥—Ä:</span>
              <span class="stats-value">${total}</span>
            </div>
          </div>
        `;
      }
    }

    // –ò–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞
    function goToStartScreen() {
      if (!currentUser) {
        showNotification("–û—à–∏–±–∫–∞", "–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Å—Ç—è");
        return;
      }
      document.getElementById('main-menu').classList.remove('active');
      document.getElementById('start-screen').classList.add('active');
    }

    function startToss() {
      playSound('toss');
      const dice = document.getElementById('dice');
      dice.textContent = '?';
      dice.className = 'dice animate';
      dice.style.border = '3px solid #4deeea';
      dice.style.boxShadow = '0 0 20px rgba(77, 238, 234, 0.3)';

      setTimeout(() => {
        const firstPlayer = Math.random() > 0.5 ? 'human' : 'bot';
        dice.textContent = firstPlayer === 'human' ? 'üë§' : 'ü§ñ';
        dice.style.color = firstPlayer === 'human' ? '#4deeea' : '#ff6b6b';
        dice.style.border = `3px solid ${firstPlayer === 'human' ? '#4deeea' : '#ff6b6b'}`;
        dice.style.boxShadow = `0 0 30px ${firstPlayer === 'human' ? 'rgba(77, 238, 234, 0.6)' : 'rgba(255, 107, 107, 0.6)'}`;
        dice.classList.remove('animate');

        setTimeout(() => {
          document.getElementById('start-screen').classList.remove('active');
          document.getElementById('game-screen').classList.add('active');
          initGame(firstPlayer);
        }, 600);
      }, 2200);
    }

    function initGame(firstPlayer) {
      board = Array(SIZE).fill().map(() => Array(SIZE).fill(0));
      reactors = Array(SIZE).fill().map(() => Array(SIZE).fill(false));
      moveCount = 0;
      gameActive = true;
      currentPlayer = firstPlayer;

      const statusEl = document.getElementById('status');
      if (currentPlayer === 'human') {
        statusEl.textContent = '–¢–≤–æ–π —Ö–æ–¥ ‚Äî –ø–æ—Å—Ç–∞–≤—å —Ä–µ–∞–∫—Ç–æ—Ä';
        statusEl.style.background = 'linear-gradient(45deg, #4deeea, #ff6b6b)';
        statusEl.style.webkitBackgroundClip = 'text';
        statusEl.style.webkitTextFillColor = 'transparent';
        statusEl.style.backgroundClip = 'text';
      } else {
        statusEl.textContent = '–ë–æ—Ç —Ö–æ–¥–∏—Ç –ø–µ—Ä–≤—ã–º...';
        statusEl.style.background = 'linear-gradient(45deg, #ff6b6b, #4deeea)';
        statusEl.style.webkitBackgroundClip = 'text';
        statusEl.style.webkitTextFillColor = 'transparent';
        statusEl.style.backgroundClip = 'text';
        render();
        setTimeout(botMove, 800);
      }
      render();
    }

    function render() {
      const boardEl = document.getElementById('board');
      boardEl.innerHTML = '';
      let youScore = 0, botScore = 0;

      for (let r = 0; r < SIZE; r++) {
        for (let c = 0; c < SIZE; c++) {
          const cell = document.createElement('div');
          cell.className = 'cell';
          if (board[r][c] === 1) {
            cell.classList.add('player1');
            youScore++;
          } else if (board[r][c] === 2) {
            cell.classList.add('player2');
            botScore++;
          }
          if (reactors[r][c]) cell.classList.add('reactor');

          if (gameActive && board[r][c] === 0 && moveCount < TOTAL_MOVES && currentPlayer === 'human') {
            cell.onclick = () => playerMove(r, c);
          }
          boardEl.appendChild(cell);
        }
      }

      document.getElementById('you-score').textContent = youScore;
      document.getElementById('bot-score').textContent = botScore;

      if (moveCount >= TOTAL_MOVES && gameActive) {
        gameActive = false;
        const statusEl = document.getElementById('status');
        let resultType = 'draw';
        if (youScore > botScore) {
          statusEl.textContent = 'üèÜ –ü–æ–±–µ–¥–∞!';
          statusEl.style.background = 'linear-gradient(45deg, #4deeea, #a8e6cf)';
          resultType = 'win';
        } else if (botScore > youScore) {
          statusEl.textContent = 'üíî –ü–æ—Ä–∞–∂–µ–Ω–∏–µ.';
          statusEl.style.background = 'linear-gradient(45deg, #ff6b6b, #ff9a8b)';
          resultType = 'loss';
        } else {
          statusEl.textContent = 'ü§ù –ù–∏—á—å—è!';
          statusEl.style.background = 'linear-gradient(45deg, #ffd700, #ffa500)';
        }
        statusEl.style.webkitBackgroundClip = 'text';
        statusEl.style.webkitTextFillColor = 'transparent';
        statusEl.style.backgroundClip = 'text';
        playSound('result');
        updateStats(resultType);
      }
    }

    // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è activateReactor
    function activateReactor(row, col, player) {
      reactors[row][col] = true;
      board[row][col] = player;
      const dirs = [[-1,0], [1,0], [0,-1], [0,1]];

      let chainReaction = false;
      for (const [dr, dc] of dirs) {
        const nr = row + dr, nc = col + dc;
        if (nr >= 0 && nr < SIZE && nc >= 0 && nc < SIZE) {
          if (reactors[nr][nc]) chainReaction = true;
        }
      }

      for (const [dr, dc] of dirs) {
        const nr = row + dr, nc = col + dc;
        if (nr >= 0 && nr < SIZE && nc >= 0 && nc < SIZE) {
          board[nr][nc] = player;
          const cellIndex = nr * SIZE + nc;
          const cell = document.querySelector(`#board > .cell:nth-child(${cellIndex + 1})`);
          if (cell && chainReaction) {
            cell.classList.remove('chain');
            void cell.offsetWidth;
            cell.classList.add('chain');
          }
        }
      }

      playSound('click');
    }

    function playerMove(r, c) {
      if (!gameActive || currentPlayer !== 'human' || board[r][c] !== 0) return;
      activateReactor(r, c, 1);
      moveCount++;
      currentPlayer = 'bot';
      if (moveCount < TOTAL_MOVES) {
        document.getElementById('status').textContent = '–•–æ–¥ –±–æ—Ç–∞...';
        document.getElementById('status').style.background = 'linear-gradient(45deg, #ff6b6b, #4deeea)';
        document.getElementById('status').style.webkitBackgroundClip = 'text';
        document.getElementById('status').style.webkitTextFillColor = 'transparent';
        document.getElementById('status').style.backgroundClip = 'text';
        render();
        setTimeout(botMove, 600);
      } else {
        render();
      }
    }

    function botMove() {
      if (!gameActive || currentPlayer !== 'bot') return;

      const phase = moveCount < 5 ? 'early' : moveCount < 10 ? 'mid' : 'late';
      let moves = [];
      const dirs = [[-1,0],[1,0],[0,-1],[0,1]];

      for (let r = 0; r < SIZE; r++) {
        for (let c = 0; c < SIZE; c++) {
          if (board[r][c] !== 0) continue;

          let baseValue = 0;
          for (const [dr, dc] of dirs) {
            const nr = r + dr, nc = c + dc;
            if (nr >= 0 && nr < SIZE && nc >= 0 && nc < SIZE) {
              if (board[nr][nc] === 1) baseValue += 10;
              else if (board[nr][nc] === 0) baseValue += 4;
              else if (board[nr][nc] === 2) baseValue += 1;
            }
          }
          if (phase === 'early' && r >= 2 && r <= 4 && c >= 2 && c <= 4) {
            baseValue += 4;
          }

          let threatValue = 0;
          for (const [dr, dc] of dirs) {
            const nr = r + dr, nc = c + dc;
            if (nr >= 0 && nr < SIZE && nc >= 0 && nc < SIZE && board[nr][nc] === 1) {
              let futureDamage = 0;
              for (const [dr2, dc2] of dirs) {
                const nnr = nr + dr2, nnc = nc + dc2;
                if (nnr >= 0 && nnr < SIZE && nnc >= 0 && nnc < SIZE) {
                  if (board[nnr][nnc] === 2) futureDamage++;
                }
              }
              threatValue = Math.max(threatValue, futureDamage * 5);
            }
          }

          let opponentResponseValue = 0;
          const simBoard = board.map(row => [...row]);
          simBoard[r][c] = 2;
          for (const [dr, dc] of dirs) {
            const nr = r + dr, nc = c + dc;
            if (nr >= 0 && nr < SIZE && nc >= 0 && nc < SIZE) {
              simBoard[nr][nc] = 2;
            }
          }
          let bestOpponentValue = 0;
          for (let or = 0; or < SIZE; or++) {
            for (let oc = 0; oc < SIZE; oc++) {
              if (simBoard[or][oc] === 0) {
                let val = 0;
                for (const [dr, dc] of dirs) {
                  const nnr = or + dr, nnc = oc + dc;
                  if (nnr >= 0 && nnr < SIZE && nnc >= 0 && nnc < SIZE) {
                    if (simBoard[nnr][nnc] === 2) val += 10;
                    else if (simBoard[nnr][nnc] === 0) val += 4;
                  }
                }
                bestOpponentValue = Math.max(bestOpponentValue, val);
              }
            }
          }
          opponentResponseValue = -bestOpponentValue * 0.7;

          let totalValue = baseValue + threatValue + opponentResponseValue;
          totalValue += (Math.random() - 0.5) * 2;

          moves.push({ r, c, value: totalValue });
        }
      }

      if (moves.length === 0) return;

      moves.sort((a, b) => b.value - a.value);
      const topMoves = moves.slice(0, 2);
      const chosen = topMoves[Math.floor(Math.random() * topMoves.length)];

      activateReactor(chosen.r, chosen.c, 2);
      moveCount++;
      currentPlayer = 'human';
      if (moveCount < TOTAL_MOVES) {
        document.getElementById('status').textContent = '–¢–≤–æ–π —Ö–æ–¥ ‚Äî –ø–æ—Å—Ç–∞–≤—å —Ä–µ–∞–∫—Ç–æ—Ä';
        document.getElementById('status').style.background = 'linear-gradient(45deg, #4deeea, #ff6b6b)';
        document.getElementById('status').style.webkitBackgroundClip = 'text';
        document.getElementById('status').style.webkitTextFillColor = 'transparent';
        document.getElementById('status').style.backgroundClip = 'text';
      }
      render();
    }

    function resetToStart() {
      document.getElementById('game-screen').classList.remove('active');
      document.getElementById('start-screen').classList.add('active');
    }

    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('active');
      if (modalId === 'profile-modal') {
        renderStats();
      }
    }

    function togglePatch(patchId) {
      const content = document.getElementById(patchId);
      const arrow = document.getElementById(`arrow-${patchId}`);
      content.classList.toggle('open');
      arrow.style.transform = content.classList.contains('open') ? 'rotate(180deg)' : 'rotate(0deg)';
    }

    function toggleInfo(sectionId) {
      const content = document.getElementById(sectionId);
      const arrow = document.getElementById(`arrow-${sectionId}`);
      content.classList.toggle('open');
      arrow.style.transform = content.classList.contains('open') ? 'rotate(180deg)' : 'rotate(0deg)';
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
    document.getElementById('google-btn').onclick = loginWithGoogle;
    document.getElementById('profile-btn').onclick = () => {
      if (!currentUser) {
        showNotification("–û—à–∏–±–∫–∞", "–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Å—Ç—è");
        return;
      }
      document.getElementById('profile-modal').classList.add('active');
    };

    document.getElementById('settings-btn').onclick = () => {
      if (!currentUser) {
        showNotification("–û—à–∏–±–∫–∞", "–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Å—Ç—è");
        return;
      }
      document.getElementById('settings-modal').classList.add('active');
    };
    document.getElementById('changelog-btn').onclick = () => {
      document.getElementById('changelog-modal').classList.add('active');
    };
    document.getElementById('support-btn').onclick = () => {
      document.getElementById('support-modal').classList.add('active');
    };
    document.getElementById('info-btn').onclick = () => {
      document.getElementById('info-modal').classList.add('active');
    };

    document.querySelectorAll('.modal-overlay').forEach(overlay => {
      overlay.addEventListener('click', (e) => {
        if (e.target === overlay) {
          overlay.classList.remove('active');
        }
      });
    });

    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    loadUser();
    renderStats();

    // –ü–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è Google OAuth
    console.log(
      "%c‚ö†Ô∏è Google OAuth: –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ 400 ‚Äî –¥–æ–±–∞–≤—å—Ç–µ –≤ Google Cloud Console:\\n" +
      "http://localhost\\nhttp://localhost:8000\\nhttp://127.0.0.1\\nhttps://–≤–∞—à-–¥–æ–º–µ–Ω.—Ä—É",
      "color: #ff6b6b; font-weight: bold;"
    );
  </script>
</body>
</html>